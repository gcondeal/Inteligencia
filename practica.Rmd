---
title: "Práctica Inteligencia y Analítica de Negocios"
author: "Gustavo Conde Alvarez"
date: "mayo de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(caret)

```

## Definición
Se trata de realizar el ajuste de una regresión múltiple sobre el conjunto de datos **candy-data.csv**. La variable de salida es el campo *winpercent*, y como variables explicativas se utilizaran todas las demás.

## Carga de datos
```{r cars}
candy.data <- read.csv("data/candy-data.csv", stringsAsFactors=TRUE)
```

## Tratamiento

### Separación en train y test
```{r}
trainIndex <- createDataPartition(candy.data$winpercent, p = .75,
list = FALSE,
times = 1)

candy.train=candy.data[trainIndex,]
candy.test=candy.data[-trainIndex,]

```

### a) Modelo múltiple
```{r}
modelo = lm(winpercent ~ chocolate + fruity + peanutyalmondy + caramel  + nougat + crispedricewafer + hard +  bar+ pluribus+ sugarpercent + pricepercent, data = candy.train)
summary(modelo)
modelo = lm(winpercent ~ chocolate + fruity + peanutyalmondy + crispedricewafer + sugarpercent, data = candy.train)
summary(modelo)
Yhat_train=predict(modelo,data.frame(candy.train[,-13]))
Yreal_train=candy.train[,"winpercent"]
ok_train=sum(Yhat_train-Yreal_train<1)/length(Yreal_train)

Yhat_test=predict(modelo,data.frame(candy.test[,-13]))
Yreal_test=candy.test[,"winpercent"]
ok_test=sum(Yhat_test-Yreal_test<1)/length(Yreal_test)

ok_train
ok_test
```

```{r}
library(corrplot)
newdatacor = cor(candy.data[,-1])
corrplot(newdatacor, method = "number")

```

### b) aplicamos bootstrap para calcular el intervalo de confianza de los estimadores

```{r}
library(boot)
stat_fun <- function(x, idx) {median(x[idx])}
boot_obj <- boot(candy.data$chocolate, R=1000, statistic = stat_fun)
boot_obj

```